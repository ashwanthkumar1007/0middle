import{a as H,b as J}from"./chunk-O44PKFFT.js";import{a as F,b as p,c as T,d as U,e as q,f as V,g as z,h as D,i as R,j,k as G,l as B,n as L,o as W,r as $}from"./chunk-DUHRLAU3.js";import{C as s,E as d,F as P,H as t,I as r,J as _,M as O,N as h,O as S,S as k,T as i,U as C,V as x,Y as w,fa as E,ga as I,ia as A,ma as N,n as M,r as f,s as b,w as y,x as o,y as v}from"./chunk-5JMWVOIS.js";function K(n,c){if(n&1&&(t(0,"div",36),i(1),r()),n&2){let a=S();o(),x(" ",a.errorMessage," ")}}function Q(n,c){n&1&&(t(0,"span",37),i(1," Product name is required "),r())}function X(n,c){n&1&&(t(0,"span",37),i(1," Product name must be at least 3 characters "),r())}function Y(n,c){if(n&1&&(t(0,"div",38),_(1,"img",39),r()),n&2){let a=S();o(),d("src",a.selectedImagePreview,y)}}function Z(n,c){n&1&&(t(0,"span",37),i(1," Product image is required "),r())}function ee(n,c){n&1&&(t(0,"span",37),i(1," Stock is required "),r())}function te(n,c){n&1&&(t(0,"span",37),i(1," Stock must be at least 1 "),r())}function re(n,c){if(n&1&&(t(0,"option",40),i(1),r()),n&2){let a=c.$implicit;d("value",a.value),o(),x(" ",a.label," ")}}function ne(n,c){n&1&&(t(0,"span",37),i(1," Price is required "),r())}function ie(n,c){n&1&&(t(0,"span",37),i(1," Price must be greater than 0 "),r())}function oe(n,c){n&1&&(t(0,"span"),i(1,"Add Product"),r())}function ae(n,c){n&1&&(t(0,"span",41),_(1,"span",42),i(2," Adding... "),r())}var be=(()=>{class n{constructor(a,l,e,m){this.fb=a,this.router=l,this.productStorageService=e,this.storageService=m,this.availableUnits=H,this.isSubmitting=!1,this.errorMessage="",this.selectedImagePreview=null,this.sellerMobileNumber=""}ngOnInit(){if(this.sellerMobileNumber=this.storageService.getMobileNumber()||"",!this.sellerMobileNumber){this.router.navigate(["/auth/mobile"],{queryParams:{role:"farmer"}});return}this.initForm()}initForm(){this.productForm=this.fb.group({name:["",[p.required,p.minLength(3)]],imageUrl:["",[p.required]],currentStock:[0,[p.required,p.min(1)]],unit:["kg",[p.required]],pricePerUnit:[0,[p.required,p.min(.01)]]})}onImageSelected(a){let e=a.target.files?.[0];if(!e)return;if(!e.type.startsWith("image/")){this.errorMessage="Please select an image file";return}if(e.size>5*1024*1024){this.errorMessage="Image size must be less than 5MB";return}let m=new FileReader;m.onload=u=>{let g=u.target?.result;this.selectedImagePreview=g,this.productForm.patchValue({imageUrl:g}),this.errorMessage=""},m.readAsDataURL(e)}get expectedRevenue(){let a=this.productForm.get("currentStock")?.value||0,l=this.productForm.get("pricePerUnit")?.value||0;return a*l}get formattedExpectedRevenue(){return`\u20B9${this.expectedRevenue.toLocaleString("en-IN")}`}hasError(a,l){let e=this.productForm.get(a);return!!(e&&e.hasError(l)&&(e.dirty||e.touched))}onSubmit(){if(this.productForm.invalid){this.productForm.markAllAsTouched(),this.errorMessage="Please fill in all required fields";return}this.isSubmitting=!0,this.errorMessage="";let a=this.productForm.value,l={productId:"",sellerMobileNumber:this.sellerMobileNumber,name:a.name,imageUrl:a.imageUrl,unit:a.unit,pricePerUnit:a.pricePerUnit,initialStock:a.currentStock,currentStock:a.currentStock,unitsSold:0,createdDate:new Date().toISOString().split("T")[0]};this.productStorageService.addProduct(l)?this.router.navigate(["/seller"]):(this.errorMessage="Failed to add product. Please try again.",this.isSubmitting=!1)}onCancel(){this.router.navigate(["/seller"])}static{this.\u0275fac=function(l){return new(l||n)(v(L),v(N),v(J),v($))}}static{this.\u0275cmp=M({type:n,selectors:[["app-add-product"]],standalone:!0,features:[w],decls:68,vars:23,consts:[["fileInput",""],[1,"add-product"],[1,"add-product__container"],[1,"add-product__header"],["type","button","aria-label","Go back",1,"add-product__back-btn",3,"click"],["aria-hidden","true"],[1,"add-product__title"],["class","add-product__error","role","alert",4,"ngIf"],[1,"add-product__form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","productName",1,"form-label"],[1,"required"],["type","text","id","productName","formControlName","name","placeholder","e.g., Organic Wheat",1,"form-input"],["class","form-error",4,"ngIf"],[1,"form-label"],[1,"image-upload"],["type","file","accept","image/*","capture","environment",2,"display","none",3,"change"],["class","image-preview",4,"ngIf"],["type","button",1,"image-upload__btn",3,"click"],[1,"image-upload__icon"],[1,"form-row"],["for","stock",1,"form-label"],["type","number","id","stock","formControlName","currentStock","placeholder","100","min","1",1,"form-input"],["for","unit",1,"form-label"],["id","unit","formControlName","unit",1,"form-input"],[3,"value",4,"ngFor","ngForOf"],["for","price",1,"form-label"],["type","number","id","price","formControlName","pricePerUnit","placeholder","50","min","0.01","step","0.01",1,"form-input"],[1,"revenue-section"],[1,"revenue-label"],[1,"revenue-value"],[1,"form-actions"],["type","button",1,"btn","btn--secondary",3,"click","disabled"],["type","submit",1,"btn","btn--primary",3,"disabled"],[4,"ngIf"],["class","loading-content",4,"ngIf"],["role","alert",1,"add-product__error"],[1,"form-error"],[1,"image-preview"],["alt","Product preview",3,"src"],[3,"value"],[1,"loading-content"],[1,"spinner"]],template:function(l,e){if(l&1){let m=O();t(0,"div",1)(1,"div",2)(2,"header",3)(3,"button",4),h("click",function(){return f(m),b(e.onCancel())}),t(4,"span",5),i(5,"\u2190"),r()(),t(6,"h1",6),i(7,"Add New Product"),r()(),s(8,K,2,1,"div",7),t(9,"form",8),h("ngSubmit",function(){return f(m),b(e.onSubmit())}),t(10,"div",9)(11,"label",10),i(12," Product Name "),t(13,"span",11),i(14,"*"),r()(),_(15,"input",12),s(16,Q,2,0,"span",13)(17,X,2,0,"span",13),r(),t(18,"div",9)(19,"label",14),i(20," Product Image "),t(21,"span",11),i(22,"*"),r()(),t(23,"div",15)(24,"input",16,0),h("change",function(g){return f(m),b(e.onImageSelected(g))}),r(),s(26,Y,2,1,"div",17),t(27,"button",18),h("click",function(){f(m);let g=k(25);return b(g.click())}),t(28,"span",19),i(29,"\u{1F4F7}"),r(),t(30,"span"),i(31),r()()(),s(32,Z,2,0,"span",13),r(),t(33,"div",20)(34,"div",9)(35,"label",21),i(36," Available Stock "),t(37,"span",11),i(38,"*"),r()(),_(39,"input",22),s(40,ee,2,0,"span",13)(41,te,2,0,"span",13),r(),t(42,"div",9)(43,"label",23),i(44," Unit "),t(45,"span",11),i(46,"*"),r()(),t(47,"select",24),s(48,re,2,2,"option",25),r()()(),t(49,"div",9)(50,"label",26),i(51," Price per Unit (\u20B9) "),t(52,"span",11),i(53,"*"),r()(),_(54,"input",27),s(55,ne,2,0,"span",13)(56,ie,2,0,"span",13),r(),t(57,"div",28)(58,"div",29),i(59,"Expected Revenue"),r(),t(60,"div",30),i(61),r()(),t(62,"div",31)(63,"button",32),h("click",function(){return f(m),b(e.onCancel())}),i(64," Cancel "),r(),t(65,"button",33),s(66,oe,2,0,"span",34)(67,ae,3,0,"span",35),r()()()()()}l&2&&(o(8),d("ngIf",e.errorMessage),o(),d("formGroup",e.productForm),o(6),P("form-input--error",e.hasError("name","required")||e.hasError("name","minlength")),o(),d("ngIf",e.hasError("name","required")),o(),d("ngIf",e.hasError("name","minlength")),o(9),d("ngIf",e.selectedImagePreview),o(5),C(e.selectedImagePreview?"Change Photo":"Take Photo / Upload"),o(),d("ngIf",e.hasError("imageUrl","required")),o(7),P("form-input--error",e.hasError("currentStock","required")||e.hasError("currentStock","min")),o(),d("ngIf",e.hasError("currentStock","required")),o(),d("ngIf",e.hasError("currentStock","min")),o(7),d("ngForOf",e.availableUnits),o(6),P("form-input--error",e.hasError("pricePerUnit","required")||e.hasError("pricePerUnit","min")),o(),d("ngIf",e.hasError("pricePerUnit","required")),o(),d("ngIf",e.hasError("pricePerUnit","min")),o(5),C(e.formattedExpectedRevenue),o(2),d("disabled",e.isSubmitting),o(2),d("disabled",e.productForm.invalid||e.isSubmitting),o(),d("ngIf",!e.isSubmitting),o(),d("ngIf",e.isSubmitting))},dependencies:[A,E,I,W,q,j,G,F,V,R,T,U,B,z,D],styles:[".add-product[_ngcontent-%COMP%]{min-height:100vh;background-color:#fafafa;padding:2rem}.add-product__container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.add-product__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;margin-bottom:3rem}.add-product__back-btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;background:#fff;border:1px solid #e0e0e0;border-radius:.5rem;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;color:#212121;cursor:pointer;transition:all .15s ease-in-out}.add-product__back-btn[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;border-color:#212121}.add-product__back-btn[_ngcontent-%COMP%]:focus-visible{outline:3px solid rgba(255,255,255,.8);outline-offset:2px}.add-product__title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#212121;margin:0}.add-product__error[_ngcontent-%COMP%]{background-color:#fee;color:#c00;padding:1.5rem;border-radius:.5rem;margin-bottom:2rem;border:1px solid #fcc}.add-product__form[_ngcontent-%COMP%]{background:#fff;padding:3rem;border-radius:1rem;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d}.form-group[_ngcontent-%COMP%]{margin-bottom:2rem}.form-label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:600;color:#212121;margin-bottom:.5rem}.form-label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#dc3545}.form-input[_ngcontent-%COMP%]{width:100%;padding:1rem 1.5rem;border:1px solid #e0e0e0;border-radius:.5rem;font-size:1rem;color:#212121;transition:all .15s ease-in-out}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#212121;box-shadow:0 0 0 3px #2121211a}.form-input--error[_ngcontent-%COMP%]{border-color:#dc3545}.form-input--error[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #dc35451a}.form-input[_ngcontent-%COMP%]::placeholder{color:#bdbdbd}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:1.5rem}.form-error[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:#dc3545;margin-top:.5rem}.image-upload__btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;width:100%;padding:1.5rem;background-color:#f5f5f5;border:2px dashed #e0e0e0;border-radius:.5rem;color:#757575;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .15s ease-in-out;display:flex;align-items:center;justify-content:center;gap:1rem}.image-upload__btn[_ngcontent-%COMP%]:hover{background-color:#eee;border-color:#212121}.image-upload__btn[_ngcontent-%COMP%]:focus-visible{outline:3px solid rgba(255,255,255,.8);outline-offset:2px}.image-upload__icon[_ngcontent-%COMP%]{font-size:1.25rem}.image-preview[_ngcontent-%COMP%]{width:100%;height:200px;margin-bottom:1.5rem;border-radius:.5rem;overflow:hidden;background-color:#f5f5f5}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.revenue-section[_ngcontent-%COMP%]{background-color:#2121210d;border:1px solid rgba(33,33,33,.2);border-radius:.5rem;padding:2rem;margin-bottom:2rem;text-align:center}.revenue-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#757575;margin-bottom:.5rem}.revenue-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#212121;margin-bottom:.5rem}.revenue-hint[_ngcontent-%COMP%]{font-size:.75rem;color:#757575}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1.5rem;margin-top:3rem}.btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;flex:1;padding:1.5rem 2rem;border-radius:.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .15s ease-in-out;border:none;display:flex;align-items:center;justify-content:center}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn[_ngcontent-%COMP%]:focus-visible{outline:3px solid rgba(255,255,255,.8);outline-offset:2px}.btn--primary[_ngcontent-%COMP%]{background-color:#212121;color:#fff}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#424242}.btn--secondary[_ngcontent-%COMP%]{background-color:#fff;color:#212121;border:1px solid #e0e0e0}.btn--secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5;border-color:#212121}.loading-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}}return n})();export{be as AddProductComponent};
