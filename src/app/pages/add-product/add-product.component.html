<div class="add-product">
  <div class="add-product__container">
    <!-- Header -->
    <header class="add-product__header">
      <button 
        type="button"
        class="add-product__back-btn"
        (click)="onCancel()"
        aria-label="Go back">
        <span aria-hidden="true">‚Üê</span>
      </button>
      <h1 class="add-product__title">Add New Product</h1>
    </header>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="add-product__error" role="alert">
      {{ errorMessage }}
    </div>

    <!-- Form -->
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="add-product__form">
      
      <!-- Product Name -->
      <div class="form-group">
        <label class="form-label" for="productName">
          Product Name <span class="required">*</span>
        </label>
        <input 
          type="text"
          id="productName"
          class="form-input"
          formControlName="name"
          placeholder="e.g., Organic Wheat"
          [class.form-input--error]="hasError('name', 'required') || hasError('name', 'minlength')">
        <span class="form-error" *ngIf="hasError('name', 'required')">
          Product name is required
        </span>
        <span class="form-error" *ngIf="hasError('name', 'minlength')">
          Product name must be at least 3 characters
        </span>
      </div>

      <!-- Image Upload -->
      <div class="form-group">
        <label class="form-label">
          Product Image <span class="required">*</span>
        </label>
        <div class="image-upload">
          <input 
            type="file"
            #fileInput
            accept="image/*"
            capture="environment"
            (change)="onImageSelected($event)"
            style="display: none;">
          
          <!-- Image Preview -->
          <div *ngIf="selectedImagePreview" class="image-preview">
            <img [src]="selectedImagePreview" alt="Product preview">
          </div>

          <!-- Upload Button -->
          <button 
            type="button"
            class="image-upload__btn"
            (click)="fileInput.click()">
            <span class="image-upload__icon">üì∑</span>
            <span>{{ selectedImagePreview ? 'Change Photo' : 'Take Photo / Upload' }}</span>
          </button>
        </div>
        <span class="form-error" *ngIf="hasError('imageUrl', 'required')">
          Product image is required
        </span>
      </div>

      <!-- Available Stock and Unit -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="stock">
            Available Stock <span class="required">*</span>
          </label>
          <input 
            type="number"
            id="stock"
            class="form-input"
            formControlName="currentStock"
            placeholder="100"
            min="1"
            [class.form-input--error]="hasError('currentStock', 'required') || hasError('currentStock', 'min')">
          <span class="form-error" *ngIf="hasError('currentStock', 'required')">
            Stock is required
          </span>
          <span class="form-error" *ngIf="hasError('currentStock', 'min')">
            Stock must be at least 1
          </span>
        </div>

        <div class="form-group">
          <label class="form-label" for="unit">
            Unit <span class="required">*</span>
          </label>
          <select 
            id="unit"
            class="form-input"
            formControlName="unit">
            <option 
              *ngFor="let unit of availableUnits" 
              [value]="unit.value">
              {{ unit.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- Price Per Unit -->
      <div class="form-group">
        <label class="form-label" for="price">
          Price per Unit (‚Çπ) <span class="required">*</span>
        </label>
        <input 
          type="number"
          id="price"
          class="form-input"
          formControlName="pricePerUnit"
          placeholder="50"
          min="0.01"
          step="0.01"
          [class.form-input--error]="hasError('pricePerUnit', 'required') || hasError('pricePerUnit', 'min')">
        <span class="form-error" *ngIf="hasError('pricePerUnit', 'required')">
          Price is required
        </span>
        <span class="form-error" *ngIf="hasError('pricePerUnit', 'min')">
          Price must be greater than 0
        </span>
      </div>

      <!-- Expected Revenue (Read-only) -->
      <div class="revenue-section">
        <div class="revenue-label">Expected Revenue</div>
        <div class="revenue-value">{{ formattedExpectedRevenue }}</div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button 
          type="button"
          class="btn btn--secondary"
          (click)="onCancel()"
          [disabled]="isSubmitting">
          Cancel
        </button>
        <button 
          type="submit"
          class="btn btn--primary"
          [disabled]="productForm.invalid || isSubmitting">
          <span *ngIf="!isSubmitting">Add Product</span>
          <span *ngIf="isSubmitting" class="loading-content">
            <span class="spinner"></span>
            Adding...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
